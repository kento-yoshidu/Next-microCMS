import Head from 'next/head'
import Link from "next/link"
import styles from '../styles/index.module.scss'

import { client } from "../libs/client"
import { Date } from "../libs/dateFormat"

import Header from "../src/components/Header"

const Styles = require("../styles/index.module.scss")

const Index = ({blog, news}) => {
  return (
    <div>
      <Head>
        <title>NextJS microCMS Site</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Philosopher" />
      </Head>

      <div className={Styles.bigBg}>
        <Header />

        <div className={styles.hero}>
          <h2 className={Styles.pageTitle}>We'll Make You're Day</h2>
          <p>酒場で、指揮者が歯医者を無視する気がした。</p>
          <Link
            href="/"
          >
            <a className={Styles.button}>
              メニューを見る
            </a>
          </Link>
        </div>
      </div>

      <main className={styles.main}>

        <section className={Styles.newsSection}>

          <div className={Styles.titleWrapper}>
            <h2 className={Styles.title}>News</h2>
          </div>

          <div className={Styles.wrapper}>
            <article>
              <header className={Styles.postInfo}>
                <h2 className={Styles.postTitle}>{news[0].title}</h2>
                <p className={Styles.postDate}><Date dateString={news[0].createdAt} /></p>
              </header>
            </article>

            <div>
              {news.map((news) => (
                <h2 key={news.id}>
                  {news.title}
                  {news.createdAt}
                </h2> 
              ))}
            </div>
          </div>
        </section>

        {blog.map((article) => (
          <h2 key={article.id}>
            {article.title}
          </h2> 
        ))}

      </main>
    </div>
  )
}

export default Index

export const getStaticProps = async () => {
  const blogData = await client.get<ResponseType>({
    endpoint: "blog",
  })

  const newsData = await client.get<ResponseType>({
    endpoint: "news",
    queries: {
      filters: "flag[equals]true",
    }
  })

  return {
    props: {
      blog: blogData.contents,
      news: newsData.contents
    }
  }
}